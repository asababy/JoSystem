<UserControl x:Class="JoSystem.Views.HomeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:JoSystem.ViewModels"
             xmlns:conv="clr-namespace:JoSystem.Converters"
             mc:Ignorable="d"
             d:DesignWidth="900" d:DesignHeight="600"
             FontFamily="{StaticResource GlobalFontFamily}">

    <UserControl.DataContext>
        <vm:HomeViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <conv:IconConverter x:Key="IconConverter"/>
        <conv:StatusColorConverter x:Key="StatusColorConverter"/>
    </UserControl.Resources>

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 顶部标题 -->
        <StackPanel Grid.Row="0" Margin="25,20,25,10">
            <TextBlock Text="{DynamicResource Lang.Home.Title}" Style="{StaticResource HeaderTextStyle}" Margin="0,0,0,5"/>
            <TextBlock Text="{DynamicResource Lang.Home.Subtitle}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="{StaticResource FontSizeSmall}"/>
        </StackPanel>

        <!-- 操作面板 -->
        <Border Grid.Row="1" Margin="25,10" Style="{StaticResource CardStyle}" Padding="15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" >
                <Button Command="{Binding StartServerCommand}" IsEnabled="{Binding CanStart}" Style="{StaticResource PrimaryButtonStyle}" Height="{StaticResource StandardControlHeight}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{DynamicResource Lang.Home.Start}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <Button Command="{Binding StopServerCommand}" IsEnabled="{Binding CanStop}" Style="{StaticResource DangerButtonStyle}" Height="{StaticResource StandardControlHeight}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE73B;" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{DynamicResource Lang.Home.Stop}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>
        
        <!-- 底部状态栏 -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="15,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Column="0">
                    <TextBlock Text="{DynamicResource Lang.Home.ServiceStatus}" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock FontWeight="Bold" VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="{Binding ServerStatus}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="Running">
                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                        <Setter Property="Text" Value="{DynamicResource Lang.Home.Running}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="Stopped">
                                        <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                                        <Setter Property="Text" Value="{DynamicResource Lang.Home.Stopped}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <!-- 如果是服务模式且正在运行，显示 (Backend) 标记 -->
                    <TextBlock Text=" (Backend)" Foreground="#FF8C00" FontWeight="Bold" VerticalAlignment="Center" 
                               Visibility="{Binding IsServiceModeAndRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Right" Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="{DynamicResource Lang.Home.ServiceAddress}" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding ServerUrl}" Foreground="{StaticResource PrimaryBrush}" VerticalAlignment="Center" Margin="0,0,2,0" Cursor="Hand" MouseLeftButtonDown="Url_MouseLeftButtonDown" ToolTip="点击访问"/>
                    <Button Command="{Binding CopyUrlCommand}" Style="{StaticResource TextButtonStyle}" FontSize="12" VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE8C8;" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" Margin="2,0"/>
                            <TextBlock VerticalAlignment="Center" Margin="0,0,2,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="{DynamicResource Lang.Home.Copy}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CopyButtonText}" Value="Copied">
                                                <Setter Property="Text" Value="{DynamicResource Lang.Home.Copied}"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding CopyButtonText}" Value="已复制">
                                                <Setter Property="Text" Value="{DynamicResource Lang.Home.Copied}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>

